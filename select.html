<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Add Dish — The Limitless She Buffet</title>
<style>
:root{ --cream:#FDF4D7; --ink:#2F2F2F; --muted:#3D3D3D; --border:#FDF4D7; --blue:#91C8E4; }
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--cream);color:var(--ink);
  font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, "Noto Sans", sans-serif}
/* Ticker */
.ticker{position:sticky; top:0; z-index:1000; background:var(--blue); overflow:hidden; border-bottom:1px solid rgba(0,0,0,.04)}
.ticker__line{display:flex; white-space:nowrap; gap:40px; padding:6px 0}
.ticker__item{font-family: Georgia, 'Times New Roman', serif; font-weight:400; font-size:11px; color:#3D3D3D; opacity:.98}
@keyframes scroll{ 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }
.ticker__inner{display:inline-flex; gap:40px; animation:scroll 24s linear infinite}
/* Layout */
.container{max-width:720px;margin:0 auto;padding:24px}
.header{display:flex;align-items:center;gap:14px;margin:14px 0 18px;justify-content:center}
.logo{height:90px;background:transparent;box-shadow:none}
.card{position:relative;background:#fff;border:1px solid var(--border);border-radius:16px;padding:18px 18px 20px;box-shadow:0 4px 14px rgba(0,0,0,.03)}
p{line-height:1.7;margin:8px 0}
ul{margin:8px 0 0 18px}
.btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
.btn{appearance:none;border:1px solid var(--ink);background:var(--ink);color:#fff;padding:10px 14px;border-radius:12px;font-weight:700;text-decoration:none;cursor:pointer}
.btn.ghost{background:#fff;color:var(--ink);border-color:#d9d4c3}
/* 12px for the two secondary buttons */
#finishBtn, #clearBtn{font-size:12px}
.btns-secondary{margin-top:14px}
.small{color:#666;font-size:12px}
.hr{height:1px;background:var(--cream);margin:14px 0}
.note{background:#fff5c7;border:1px dashed #e2d89b;padding:10px 12px;border-radius:12px}
.hidden{display:none}
/* Toast */
.toast{position:fixed;right:16px;bottom:16px;background:#111;color:#fff;
  padding:10px 14px;border-radius:10px;font-size:12px;opacity:0;transform:translateY(6px);
  transition:opacity .22s ease, transform .22s ease; z-index:9999; max-width:70vw}
.toast.show{opacity:1; transform:translateY(0)}
/* Check pulse */
.pulse{position:absolute; right:16px; top:16px; width:34px; height:34px; border-radius:50%;
  background:#27AE60; color:#fff; display:flex; align-items:center; justify-content:center;
  font-weight:800; box-shadow:0 6px 18px rgba(39,174,96,.35); opacity:0; transform:scale(.8)}
@keyframes pop {
  0%{opacity:0; transform:scale(.6)}
  40%{opacity:1; transform:scale(1.1)}
  60%{transform:scale(.95)}
  100%{opacity:1; transform:scale(1)}
}
.pulse.show{animation:pop .38s ease forwards}
</style>
</head>
<body>
  <div class="ticker">
    <div class="ticker__line">
      <div class="ticker__inner">
        <div class="ticker__item">* Allergic Notice: Some ingredients may not sit lightly.</div>
        <div class="ticker__item">* Allergic Notice: Some ingredients may not sit lightly.</div>
        <div class="ticker__item">* Allergic Notice: Some ingredients may not sit lightly.</div>
        <div class="ticker__item">* Allergic Notice: Some ingredients may not sit lightly.</div>
        <div class="ticker__item">* Allergic Notice: Some ingredients may not sit lightly.</div>
      </div>
      <div class="ticker__inner">
        <div class="ticker__item">* Allergic Notice: Some ingredients may not sit lightly.</div>
        <div class="ticker__item">* Allergic Notice: Some ingredients may not sit lightly.</div>
        <div class="ticker__item">* Allergic Notice: Some ingredients may not sit lightly.</div>
        <div class="ticker__item">* Allergic Notice: Some ingredients may not sit lightly.</div>
        <div class="ticker__item">* Allergic Notice: Some ingredients may not sit lightly.</div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="header"><img class="logo" src="/logo.png" alt="The Limitless She Buffet Logo"/></div>

    <div class="card">
      <div id="pulse" class="pulse">✓</div>
      <p id="which">Dish:</p>

      <div class="hr"></div>

      <p><strong>Your current selection</strong>:</p>
      <ul id="list"></ul>

      <!-- Secondary action row UNDER the list -->
      <div class="btns btns-secondary" id="secondaryRow">
        <a class="btn ghost" id="finishBtn" href="./finish.html">Checkout now</a>
        <button class="btn ghost" id="clearBtn">Clear & Start over</button>
      </div>

      <div id="next" class="note hidden" style="margin-top:14px;">
        You can now leave this page and continue scanning other dishes!
      </div>

      <p class="small">Everything is stored locally on your device. Nothing is uploaded.</p>
    </div>
  </div>

<div id="toast" class="toast">Added. You can now leave this page and continue scanning other dishes!</div>

<script>
const NAMES = {
  "item-a1": "Rule of Five",
  "item-a2": "Slow-Posted Connection",
  "item-a3": "Her Own Reason for Being",
  "item-b1": "The Last Biscuit",
  "item-b2": "Constellations Made of Shame",
  "item-b3": "The Auto-Pilot Daughters",
  "item-b4": "A Seat at the Table",
  "item-c1": "The Charm",
  "item-c2": "The Canned Beliefs",
  "item-c3": "The Mirror",
  "item-d1": "To Please, and Be Loved",
  "item-d2": "Harmony, or Something Like It",
  "item-d3": "All Essential, But…"
};
const params = new URLSearchParams(location.search);
const item = params.get('item');
const KEY = 'selectedDishes';
const read = () => JSON.parse(localStorage.getItem(KEY) || '[]');
const write = (arr) => localStorage.setItem(KEY, JSON.stringify(arr));
const nameOf = (id) => NAMES[id] || "Untitled Dish";

function renderList(){
  const listEl = document.getElementById('list');
  const dishes = read();
  listEl.innerHTML = '';
  if(dishes.length===0){
    const li = document.createElement('li'); li.textContent = '(No dishes selected yet)'; listEl.appendChild(li);
  } else {
    dishes.forEach(d => { const li = document.createElement('li'); li.textContent = nameOf(d); listEl.appendChild(li); });
  }
  document.getElementById('secondaryRow').style.display = dishes.length ? 'flex' : 'none';
}

// Toast + pulse helpers
function showToast(){
  const t = document.getElementById('toast');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 1800);
}
function pulse(){
  const p = document.getElementById('pulse');
  p.classList.remove('show'); // restart animation
  void p.offsetWidth;
  p.classList.add('show');
}

(function autoAdd(){
  document.getElementById('which').innerHTML = 'Dish: <strong>' + (item ? nameOf(item) : 'Not specified') + '</strong>';
  if(!item){ renderList(); return; }

  let dishes = read();
  let added = false;
  if(!dishes.includes(item)){
    dishes.push(item); write(dishes); added = true;
  }
  // Always show the leave-note on load
  document.getElementById('next').classList.remove('hidden');
  if (navigator.vibrate) try { navigator.vibrate(30); } catch(e){}
  renderList();

  // Feedback
  showToast();
  pulse();
})();

document.getElementById('clearBtn').addEventListener('click', () => {
  if(confirm('Clear your current selection?')){
    localStorage.removeItem(KEY);
    renderList();
    document.getElementById('next').classList.add('hidden');
  }
});
</script>
</body>
</html>
