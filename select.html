<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>餐點已加入｜The Limitless She Buffet</title>
  <style>
    :root { --bg:#fff; --fg:#111; --muted:#666; --accent:#111; }
    html,body { margin:0; padding:0; background:var(--bg); color:var(--fg); font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial; }
    .wrap { max-width: 520px; margin: 8vh auto; padding: 24px; }
    h1 { font-size: 24px; margin: 0 0 8px; }
    p { line-height: 1.6; margin: 8px 0; }
    code { background:#f6f6f6; padding: 2px 6px; border-radius:6px; }
    .card { border: 1px solid #eee; border-radius: 12px; padding: 16px 18px; box-shadow: 0 1px 6px rgba(0,0,0,.04); }
    .btns { display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
    a.btn, button.btn { appearance:none; border:1px solid #222; background:#111; color:#fff; padding:10px 14px; border-radius:10px; font-weight:600; text-decoration:none; }
    a.ghost, button.ghost { background:#fff; color:#111; border-color:#ddd; }
    .small { font-size: 12px; color: var(--muted); }
    ul { margin:8px 0 0 18px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>餐點已加入</h1>
      <p id="added">正在加入中…</p>
      <p><strong>目前已選</strong>（依掃碼順序）：</p>
      <ul id="list"></ul>
      <div class="btns">
        <a class="btn" href="./finish.html">完成點餐 → 生成專屬連結</a>
        <button class="btn ghost" id="clear">清空重選</button>
      </div>
      <p class="small">提示：每位觀眾的選擇儲存在你自己的裝置上（不會上傳）。你可以持續掃描更多餐點，再回到這頁點「完成點餐」。</p>
    </div>
  </div>

  <script>
    // 允許 /select.html?item=item-a1 或 /select?item=item-a1
    const params = new URLSearchParams(location.search);
    const item = params.get('item');

    const key = 'selectedDishes';
    const read = () => JSON.parse(localStorage.getItem(key) || '[]');
    const write = (arr) => localStorage.setItem(key, JSON.stringify(arr));

    const listEl = document.getElementById('list');
    const addedEl = document.getElementById('added');

    let dishes = read();

    if (item) {
      if (!dishes.includes(item)) {
        dishes.push(item);
        write(dishes);
        addedEl.textContent = `已加入：${item}`;
      } else {
        addedEl.textContent = `已在清單中：${item}`;
      }
    } else {
      addedEl.textContent = '沒有指定餐點（URL 需包含 ?item=...）';
    }

    function renderList() {
      listEl.innerHTML = '';
      if (dishes.length === 0) {
        const li = document.createElement('li');
        li.textContent = '（尚未選擇任何餐點）';
        listEl.appendChild(li);
        return;
      }
      dishes.forEach(d => {
        const li = document.createElement('li');
        li.textContent = d;
        listEl.appendChild(li);
      });
    }
    renderList();

    document.getElementById('clear').addEventListener('click', () => {
      if (confirm('確定要清空已選餐點嗎？')) {
        localStorage.removeItem(key);
        dishes = [];
        renderList();
        addedEl.textContent = '已清空。請掃描餐點 QR code 重新加入。';
      }
    });
  </script>
</body>
</html>
